<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ë–æ–µ—Ü ‚Äî Sherdoc KG</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #111 60%, #e10600 100%);
      color: #fff;
      min-height: 100vh;
    }
    .fighter-card {
      background: #181818cc;
      border-radius: 18px;
      box-shadow: 0 4px 24px #e1060033;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 800px;
    }
    .fighter-header {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
      gap: 2rem;
    }
    .fighter-photo {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #e10600;
    }
    .fighter-info h1 {
      color: #e10600;
      margin-bottom: 0.5rem;
    }
    .fighter-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    .stat-card {
      background: #222;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #444;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #e10600;
    }
    .stat-label {
      font-size: 0.9rem;
      color: #ccc;
    }
    .history-section {
      margin-top: 2rem;
    }
    .history-item {
      background: #222;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #e10600;
      transition: all 0.3s;
    }
    .history-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .history-item.win {
      border-left-color: #28a745;
      background: linear-gradient(135deg, #222 0%, #1a3d1a 100%);
    }
    .history-item.loss {
      border-left-color: #dc3545;
      background: linear-gradient(135deg, #222 0%, #3d1a1a 100%);
    }
    .history-item.draw {
      border-left-color: #ffc107;
      background: linear-gradient(135deg, #222 0%, #3d3a1a 100%);
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .history-opponent {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .opponent-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #444;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #fff;
    }
    .opponent-info h4 {
      margin: 0;
      color: #fff;
    }
    .opponent-details {
      font-size: 0.9rem;
      color: #ccc;
    }
    .history-result {
      font-weight: bold;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .history-result.win {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }
    .history-result.loss {
      background: linear-gradient(135deg, #dc3545, #e74c3c);
      color: white;
    }
    .history-result.draw {
      background: linear-gradient(135deg, #ffc107, #ffeb3b);
      color: black;
    }
    .history-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .detail-item {
      background: rgba(255,255,255,0.1);
      padding: 0.75rem;
      border-radius: 8px;
      text-align: center;
    }
    .detail-label {
      font-size: 0.8rem;
      color: #ccc;
      margin-bottom: 0.25rem;
    }
    .detail-value {
      font-weight: bold;
      color: #fff;
    }
    .history-stats {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #444;
    }
    .stat-item {
      text-align: center;
      flex: 1;
    }
    .stat-number {
      font-size: 1.2rem;
      font-weight: bold;
      color: #e10600;
    }
    .stat-text {
      font-size: 0.8rem;
      color: #ccc;
    }
    .history-summary {
      background: linear-gradient(135deg, #222 0%, #333 100%);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 2px solid #444;
    }
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
    }
    .summary-item {
      text-align: center;
      padding: 1rem;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .summary-number {
      font-size: 2rem;
      font-weight: bold;
      color: #e10600;
      margin-bottom: 0.5rem;
    }
    .summary-label {
      font-size: 0.9rem;
      color: #ccc;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .back-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #e10600;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(225, 6, 0, 0.3);
      transition: all 0.3s;
    }
    .back-btn:hover {
      background: #b00500;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="fighter-card">
      <div class="fighter-header">
        <img id="fighter-photo" src="" alt="–§–æ—Ç–æ –±–æ–π—Ü–∞" class="fighter-photo">
        <div class="fighter-info">
          <h1 id="fighter-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
          <p id="fighter-details">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
        </div>
      </div>
      
      <div class="fighter-stats">
        <div class="stat-card">
          <div class="stat-value" id="wins">0</div>
          <div class="stat-label">–ü–æ–±–µ–¥—ã</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="losses">0</div>
          <div class="stat-label">–ü–æ—Ä–∞–∂–µ–Ω–∏—è</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="draws">0</div>
          <div class="stat-label">–ù–∏—á—å–∏</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-fights">0</div>
          <div class="stat-label">–í—Å–µ–≥–æ –±–æ–µ–≤</div>
        </div>
      </div>
      
      <div class="history-section">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –±–æ–µ–≤</h3>
        <div id="history-summary" class="history-summary" style="display: none;">
          <div class="summary-stats">
            <div class="summary-item">
              <div class="summary-number" id="total-fights">0</div>
              <div class="summary-label">–í—Å–µ–≥–æ –±–æ–µ–≤</div>
            </div>
            <div class="summary-item">
              <div class="summary-number" id="win-rate">0%</div>
              <div class="summary-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</div>
            </div>
            <div class="summary-item">
              <div class="summary-number" id="last-fight">-</div>
              <div class="summary-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –±–æ–π</div>
            </div>
            <div class="summary-item">
              <div class="summary-number" id="current-streak">0</div>
              <div class="summary-label">–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è</div>
            </div>
          </div>
        </div>
        <div id="fight-history">
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–µ–≤...</p>
        </div>
      </div>
    </div>
  </div>
  
  <button class="back-btn" onclick="history.back()">
    <i class="bi bi-arrow-left"></i>
  </button>

  <script>
    let fighter = null;
    let fightHistory = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ–π—Ü–µ
    async function loadFighter() {
      const urlParams = new URLSearchParams(window.location.search);
      const fighterName = urlParams.get('name');
      
      if (!fighterName) {
        document.getElementById('fighter-name').textContent = '–ë–æ–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω';
        return;
      }

      try {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –±–æ–π—Ü–æ–≤ –∏ –Ω–∞—Ö–æ–¥–∏–º –Ω—É–∂–Ω–æ–≥–æ
        const response = await fetch('/api/fighters');
        const fighters = await response.json();
        fighter = fighters.find(f => f.name === fighterName);
        
        if (!fighter) {
          document.getElementById('fighter-name').textContent = '–ë–æ–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω';
          return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ–π—Ü–µ
        document.getElementById('fighter-name').textContent = fighter.name;
        document.getElementById('fighter-photo').src = fighter.photo || 'https://via.placeholder.com/150';
        document.getElementById('fighter-details').innerHTML = `
          <strong>–ö–ª—É–±:</strong> ${fighter.club || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
          <strong>–¢—Ä–µ–Ω–µ—Ä:</strong> ${fighter.coach || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
          <strong>–í–∏–¥ —Å–ø–æ—Ä—Ç–∞:</strong> ${fighter.sport}<br>
          <strong>–í–µ—Å:</strong> ${fighter.weight} –∫–≥<br>
          <strong>–†–æ—Å—Ç:</strong> ${fighter.height} —Å–º<br>
          <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${fighter.age} –ª–µ—Ç
        `;

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('wins').textContent = fighter.wins || 0;
        document.getElementById('losses').textContent = fighter.losses || 0;
        document.getElementById('draws').textContent = fighter.draws || 0;
        document.getElementById('total-fights').textContent = (fighter.wins || 0) + (fighter.losses || 0) + (fighter.draws || 0);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –±–æ–µ–≤
        await loadFightHistory();
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–π—Ü–∞:', error);
        document.getElementById('fighter-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–µ–≤
    function updateHistorySummary(history) {
      if (history.length === 0) {
        document.getElementById('history-summary').style.display = 'none';
        return;
      }
      
      document.getElementById('history-summary').style.display = 'block';
      
      // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–µ–≤
      const totalFights = history.length;
      document.getElementById('total-fights').textContent = totalFights;
      
      // –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥
      const wins = history.filter(fight => fight.result === 'win').length;
      const winRate = totalFights > 0 ? Math.round((wins / totalFights) * 100) : 0;
      document.getElementById('win-rate').textContent = `${winRate}%`;
      
      // –ü–æ—Å–ª–µ–¥–Ω–∏–π –±–æ–π
      const lastFight = history[0]; // –°–∞–º—ã–π —Å–≤–µ–∂–∏–π –±–æ–π
      const lastFightDate = new Date(lastFight.fightDate);
      const daysAgo = Math.ceil((new Date() - lastFightDate) / (1000 * 60 * 60 * 24));
      document.getElementById('last-fight').textContent = `${daysAgo} –¥–Ω. –Ω–∞–∑–∞–¥`;
      
      // –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Ä—è–¥)
      let currentStreak = 0;
      const lastResult = history[0].result;
      for (let i = 0; i < history.length; i++) {
        if (history[i].result === lastResult) {
          currentStreak++;
        } else {
          break;
        }
      }
      document.getElementById('current-streak').textContent = `${currentStreak} ${lastResult === 'win' ? '–ø–æ–±–µ–¥' : lastResult === 'loss' ? '–ø–æ—Ä–∞–∂–µ–Ω–∏–π' : '–Ω–∏—á—å–∏—Ö'}`;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–µ–≤
    async function loadFightHistory() {
      try {
        const response = await fetch(`/api/fighters/${fighter.id}/history`);
        fightHistory = await response.json();
        
        const historyContainer = document.getElementById('fight-history');
        
        if (fightHistory.length === 0) {
          historyContainer.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è –±–æ–µ–≤ –ø—É—Å—Ç–∞</p>';
          return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ–¥–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updateHistorySummary(fightHistory);
        
        historyContainer.innerHTML = fightHistory.map((fight, index) => {
          const fightDate = new Date(fight.fightDate);
          const resultText = fight.result === 'win' ? '–ü–û–ë–ï–î–ê' : fight.result === 'loss' ? '–ü–û–†–ê–ñ–ï–ù–ò–ï' : '–ù–ò–ß–¨–Ø';
          const resultIcon = fight.result === 'win' ? 'ü•ä' : fight.result === 'loss' ? 'üíî' : 'ü§ù';
          
          return `
            <div class="history-item ${fight.result}">
              <div class="history-header">
                <div class="history-opponent">
                  <div class="opponent-avatar">
                    ${fight.opponentName.charAt(0).toUpperCase()}
                  </div>
                  <div class="opponent-info">
                    <h4>${fight.opponentName}</h4>
                    <div class="opponent-details">
                      ${fight.opponentClub ? `–ö–ª—É–±: ${fight.opponentClub}` : '–ö–ª—É–± –Ω–µ —É–∫–∞–∑–∞–Ω'}
                    </div>
                  </div>
                </div>
                <span class="history-result ${fight.result}">
                  ${resultIcon} ${resultText}
                </span>
              </div>
              
              <div class="history-details">
                <div class="detail-item">
                  <div class="detail-label">–¢—É—Ä–Ω–∏—Ä</div>
                  <div class="detail-value">${fight.tournamentName}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">–†–∞—É–Ω–¥</div>
                  <div class="detail-value">${fight.round}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">–î–∞—Ç–∞</div>
                  <div class="detail-value">${fightDate.toLocaleDateString('ru-RU', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric' 
                  })}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">–í—Ä–µ–º—è</div>
                  <div class="detail-value">${fightDate.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                  })}</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">–í–µ—Å–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                  <div class="detail-value">${fight.weight} –∫–≥</div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">–í–∏–¥ —Å–ø–æ—Ä—Ç–∞</div>
                  <div class="detail-value">${fight.sport}</div>
                </div>
              </div>
              
              <div class="history-stats">
                <div class="stat-item">
                  <div class="stat-number">#${fightHistory.length - index}</div>
                  <div class="stat-text">–ë–æ–π –≤ –∫–∞—Ä—å–µ—Ä–µ</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${Math.ceil((new Date() - fightDate) / (1000 * 60 * 60 * 24))}</div>
                  <div class="stat-text">–î–Ω–µ–π –Ω–∞–∑–∞–¥</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${fight.result === 'win' ? '100%' : fight.result === 'loss' ? '0%' : '50%'}</div>
                  <div class="stat-text">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
                </div>
              </div>
            </div>
          `;
        }).join('');
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–µ–≤:', error);
        document.getElementById('fight-history').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–µ–≤</p>';
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π —Å–ø–æ—Ä—Ç–∞
    async function loadSportStyles(sportName) {
      try {
        const res = await fetch(`/api/sports`);
        const sports = await res.json();
        const sport = sports.find(s => s.name === sportName);
        
        if (sport && (sport.primaryColor || sport.secondaryColor || sport.textColor)) {
          const root = document.documentElement;
          
          if (sport.primaryColor) {
            root.style.setProperty('--sport-primary', sport.primaryColor);
            document.querySelectorAll('.red, .stat-value').forEach(el => {
              el.style.color = sport.primaryColor;
            });
            document.querySelectorAll('.history-item').forEach(el => {
              el.style.borderLeftColor = sport.primaryColor;
            });
          }
          
          if (sport.secondaryColor) {
            root.style.setProperty('--sport-secondary', sport.secondaryColor);
            document.querySelectorAll('.fighter-card, .stat-card, .history-item').forEach(el => {
              el.style.backgroundColor = sport.secondaryColor;
            });
          }
          
          if (sport.textColor) {
            root.style.setProperty('--sport-text', sport.textColor);
            document.body.style.color = sport.textColor;
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∏–ª–µ–π —Å–ø–æ—Ä—Ç–∞:', error);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', async () => {
      await loadFighter();
      if (fighter) {
        await loadSportStyles(fighter.sport);
      }
    });
  </script>
</body>
</html>