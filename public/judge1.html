<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–∞–Ω–µ–ª—å —Å—É–¥—å–∏ 1 ‚Äî Sherdoc</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(135deg, #0a0a0a 60%, #e10600 100%);
      color: #fff;
      min-height: 100vh;
      font-family: 'Arial', sans-serif;
    }
    .judge-header {
      background: #e10600;
      color: #fff;
      padding: 1rem;
      text-align: center;
      margin-bottom: 2rem;
    }
    .card {
      background: #181818cc;
      border: 1px solid #e10600;
      border-radius: 15px;
      color: #fff;
    }
    .form-control, .form-select {
      background: #2a2a2a;
      border: 1px solid #e10600;
      color: #fff;
      font-family: 'Arial', sans-serif;
    }
    .form-control:focus, .form-select:focus {
      background: #2a2a2a;
      border-color: #e10600;
      color: #fff;
      box-shadow: 0 0 0 0.2rem rgba(225, 6, 0, 0.25);
    }
    .btn-primary {
      background: #e10600;
      border: none;
    }
    .btn-primary:hover {
      background: #b80500;
    }
    .btn-success {
      background: #28a745;
      border: none;
    }
    .btn-warning {
      background: #ffc107;
      border: none;
      color: #000;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      padding: 15px 20px;
      border-radius: 10px;
      color: #fff;
      font-weight: bold;
      display: none;
    }
    .notification.success {
      background: #28a745;
    }
    .notification.error {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <div class="judge-header">
    <h2><i class="bi bi-person-badge"></i> –ü–ê–ù–ï–õ–¨ –°–£–î–¨–ò 1</h2>
    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–æ –±–æ—è</p>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–æ</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">–ë–æ–µ—Ü 1:</label>
                  <input type="text" class="form-control" id="fighter1-name" placeholder="–ò–º—è –±–æ–π—Ü–∞ 1">
                </div>
                <div class="mb-3">
                  <label class="form-label">–û—á–∫–∏ –±–æ–π—Ü–∞ 1:</label>
                  <input type="number" class="form-control" id="fighter1-score" value="0" min="0">
                </div>
                <div class="mb-3">
                  <button class="btn btn-success w-100" onclick="selectWinner(1)">üëë –ü–æ–±–µ–¥–∏—Ç–µ–ª—å 1</button>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">–ë–æ–µ—Ü 2:</label>
                  <input type="text" class="form-control" id="fighter2-name" placeholder="–ò–º—è –±–æ–π—Ü–∞ 2">
                </div>
                <div class="mb-3">
                  <label class="form-label">–û—á–∫–∏ –±–æ–π—Ü–∞ 2:</label>
                  <input type="number" class="form-control" id="fighter2-score" value="0" min="0">
                </div>
                <div class="mb-3">
                  <button class="btn btn-success w-100" onclick="selectWinner(2)">üëë –ü–æ–±–µ–¥–∏—Ç–µ–ª—å 2</button>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">–í—Ä–µ–º—è –±–æ—è (—Å–µ–∫):</label>
                  <input type="number" class="form-control" id="round-time" value="180" min="30" max="600">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">–°—Ç–∞—Ç—É—Å –±–æ—è:</label>
                  <select class="form-select" id="fight-status">
                    <option value="preparing">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</option>
                    <option value="fighting">–ò–¥–µ—Ç –±–æ–π</option>
                    <option value="break">–ü–µ—Ä–µ—Ä—ã–≤</option>
                    <option value="finished">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button class="btn btn-warning" onclick="resetScoreboard()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5>üì∫ –¢–∞–±–ª–æ —Å—É–¥—å–∏ 1</h5>
          </div>
          <div class="card-body">
            <p class="text-muted">–°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–æ:</p>
            <div class="input-group mb-3">
              <input type="text" class="form-control" id="public-link" readonly value="http://localhost:4000/scoreboard1.html">
              <button class="btn btn-outline-secondary" onclick="copyLink()">üìã</button>
            </div>
            <a href="/scoreboard1.html" target="_blank" class="btn btn-danger w-100">üëÅÔ∏è –û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–æ</a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5>üìä –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4 text-center">
                <h4 id="preview-fighter1">–ë–æ–µ—Ü 1</h4>
                <h1 id="preview-score1" class="text-danger">0</h1>
              </div>
              <div class="col-md-4 text-center">
                <h5 id="preview-round">–ë–æ–π</h5>
                <h2 id="preview-timer" class="text-success">3:00</h2>
                <p id="preview-status">–ü–û–î–ì–û–¢–û–í–ö–ê</p>
              </div>
              <div class="col-md-4 text-center">
                <h4 id="preview-fighter2">–ë–æ–µ—Ü 2</h4>
                <h1 id="preview-score2" class="text-danger">0</h1>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notification" class="notification"></div>

  <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function checkAuth() {
      const auth = localStorage.getItem('judge-auth');
      const role = localStorage.getItem('judge-role');
      const user = localStorage.getItem('judge-user');

      if (!auth || role !== 'judge') {
        window.location.href = '/judge-login.html';
        return;
      }
    }

    // –í—ã—Ö–æ–¥
    function logout() {
      localStorage.removeItem('judge-auth');
      localStorage.removeItem('judge-user');
      localStorage.removeItem('judge-role');
      window.location.href = '/judge-login.html';
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
    function copyLink() {
      const linkInput = document.getElementById('public-link');
      linkInput.select();
      document.execCommand('copy');
      showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreview() {
      document.getElementById('preview-fighter1').textContent = document.getElementById('fighter1-name').value || '–ë–æ–µ—Ü 1';
      document.getElementById('preview-fighter2').textContent = document.getElementById('fighter2-name').value || '–ë–æ–µ—Ü 2';
      document.getElementById('preview-score1').textContent = document.getElementById('fighter1-score').value || '0';
      document.getElementById('preview-score2').textContent = document.getElementById('fighter2-score').value || '0';
      document.getElementById('preview-round').textContent = '–ë–æ–π';
      
      const time = parseInt(document.getElementById('round-time').value) || 180;
      const minutes = Math.floor(time / 60);
      const seconds = time % 60;
      document.getElementById('preview-timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      const status = document.getElementById('fight-status').value;
      document.getElementById('preview-status').textContent = status.toUpperCase();
    }

    // Debounced update function
    let updateTimeout;
    function debouncedUpdate() {
      clearTimeout(updateTimeout);
      updateTimeout = setTimeout(function() {
        updatePreview();
        updateScoreboard();
      }, 500);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–æ
    function updateScoreboard() {
      const data = {
        fighter1: {
          name: document.getElementById('fighter1-name').value || '–ë–æ–µ—Ü 1',
          score: parseInt(document.getElementById('fighter1-score').value) || 0
        },
        fighter2: {
          name: document.getElementById('fighter2-name').value || '–ë–æ–µ—Ü 2',
          score: parseInt(document.getElementById('fighter2-score').value) || 0
        },
        round: 1,
        roundTime: parseInt(document.getElementById('round-time').value),
        status: document.getElementById('fight-status').value
      };
      
      fetch('/api/scoreboard1/update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          updatePreview();
        }
      })
      .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
      });
    }
    
    // –í—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    function selectWinner(fighterNumber) {
      const data = {
        fighter1: {
          name: document.getElementById('fighter1-name').value || '–ë–æ–µ—Ü 1',
          score: parseInt(document.getElementById('fighter1-score').value) || 0
        },
        fighter2: {
          name: document.getElementById('fighter2-name').value || '–ë–æ–µ—Ü 2',
          score: parseInt(document.getElementById('fighter2-score').value) || 0
        },
        round: 1,
        roundTime: parseInt(document.getElementById('round-time').value),
        status: 'finished',
        winner: fighterNumber,
        showWinner: true
      };
      
      fetch('/api/scoreboard1/update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          updatePreview();
          showNotification(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ë–æ–µ—Ü ${fighterNumber}!`, 'success');
          
          // –ß–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ —É–±–∏—Ä–∞–µ–º –ø–æ–∫–∞–∑ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
          setTimeout(function() {
            const normalData = {
              fighter1: data.fighter1,
              fighter2: data.fighter2,
              round: 1,
              roundTime: data.roundTime,
              status: 'finished',
              winner: fighterNumber,
              showWinner: false
            };
            
            fetch('/api/scoreboard1/update', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(normalData)
            });
          }, 10000);
        } else {
          showNotification('–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è', 'error');
        }
      })
      .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è', 'error');
      });
    }

    // –°–±—Ä–æ—Å —Ç–∞–±–ª–æ
    function resetScoreboard() {
      document.getElementById('fighter1-name').value = '';
      document.getElementById('fighter2-name').value = '';
      document.getElementById('fighter1-score').value = '0';
      document.getElementById('fighter2-score').value = '0';
      document.getElementById('round-time').value = '180';
      document.getElementById('fight-status').value = 'preparing';
      
      updatePreview();
      updateScoreboard();
      showNotification('–¢–∞–±–ª–æ —Å–±—Ä–æ—à–µ–Ω–æ', 'success');
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
    document.addEventListener('input', function() {
      updatePreview();
      debouncedUpdate();
    });
    
    document.addEventListener('change', function() {
      updatePreview();
      debouncedUpdate();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      checkAuth();
      updatePreview();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
